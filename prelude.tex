\usepackage[total={155mm,200mm},
            top=40mm,
            left=30mm]{geometry}
\usepackage[T1]{fontenc}
\usepackage{fix-cm}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{listings}
\usepackage{srcltx}
\usepackage{charter}
\usepackage{euler}
\usepackage{latexsym}
\usepackage{comment}
\usepackage{color}
\usepackage{proof}
\usepackage{url}
\usepackage{xspace}
\usepackage{natbib}
\usepackage{cdsty}


% ---------------------------------------------------------------------------
% ---------------------------- Names of Languages ---------------------------
% ---------------------------------------------------------------------------

\newcommand{\beluga}{\textsc{beluga}}
\newcommand{\twelf}{\textsc{twelf}}
\newcommand{\minml}{\textsc{minml}}


% ---------------------------------------------------------------------------
% ------------------------ Theorems and environments ------------------------
% ---------------------------------------------------------------------------

\newtheorem{@problem}{Exercise}[section]
\newenvironment{problem}{\begin{@problem}\rm}{\end{@problem}}
\newtheorem{@sol}{Solution}[section]
\newenvironment{sol}{\begin{@sol}\rm}{\end{@sol}}
\newtheorem{@axiom}{Axiom}
\newenvironment{axiom}{\begin{@axiom}\rm}{\end{@axiom}}

\newtheorem{definition}{Definition}[section]
\newtheorem{theorem}{Theorem}[section]
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}


% ---------------------------------------------------------------------------
% ------------------------------ Contextual ML ------------------------------
% ---------------------------------------------------------------------------

\lstdefinelanguage{ContextualML}
{
  morekeywords={and, block, case, of, mlam, fn, impossible, let, in, schema,
    some, rec, type, ctype, prop, stratified, inductive, coinductive, LF, if, then,
    else, total},
  keepspaces=true,
  sensitive,
  morecomment=[n]{(*}{*)},
  morestring=[b]"
}[keywords,comments,strings]

\lstloadlanguages{ContextualML}
\lstset{language=ContextualML}

\definecolor{dRed}{rgb}{0.65, 0.0, 0.0}
\definecolor{dGreen}{rgb}{0.133, 0.56, 0.0}

%
% Set up listings "literate" keyword stuff (for \lstset below)
%
\newdimen\zzlistingsize
\newdimen\zzlistingsizedefault
\zzlistingsizedefault=9.5pt
\zzlistingsize=\zzlistingsizedefault
\global\def\InsideComment{0}
\newcommand{\Lstbasicstyle}{\fontsize{\zzlistingsize}{1.05\zzlistingsize}\ttfamily}
\newcommand{\keywordFmt}{\fontsize{0.9\zzlistingsize}{1.0\zzlistingsize}\bf}
\newcommand{\smartkeywordFmt}{\if0\InsideComment\keywordFmt\fi}
\newcommand{\commentFmt}{\def\InsideComment{1}\fontsize{0.95\zzlistingsize}{1.0\zzlistingsize}\rmfamily\slshape}

\newcommand{\LST}{\setlistingsize{\zzlistingsizedefault}}
\newlength{\zzlstwidth}

\newcommand{\setlistingsize}[1]{
  \zzlistingsize=#1%
  \settowidth{\zzlstwidth}{{\Lstbasicstyle~}}}
\setlistingsize{\zzlistingsizedefault}

% The order of the "literate" definitions is significant:
%   later definitions shadow earlier ones.  The \\Pi definition must come
%   *after* the \\ definition, or the first part of \\Pi --- that is, \\ --- will
%   be matched, and instead of $\Pi$ you'll get $\lambda Pi$.
%
\lstset{literate={->}{{$\rightarrow~$}}2 %
                 {=>}{{$\Rightarrow~$}}2 %
                 {|-}{{$\vdash\,$}}2 %
                 {id}{{{\smartkeywordFmt id}}}1 % 3 $~$
                 {\\}{{$\lambda$}}1 %
                 {\\Pi}{{$\Pi$}}1 %
                 {\\gamma}{{$\gamma$}}1 %
                 {\\psi}{{$\psi$}}1 %
                 {FN}{{$\Lambda$}}1 %
                 % {<<}{\color{myotherblue}}1 %
                 {<<}{\color{dGreen}}1 %
                 {<<r}{\color{dRed}}1 %
                 {<*}{\color{dGreen}}1 %
                 {<dim}{\color{dimgrey}}1 %
                 {>>}{\color{black}}1 %
                 {?}{\bf{?}}1
                 ,
                 columns=[l]fullflexible,
                 basewidth=\zzlstwidth,
                 basicstyle=\Lstbasicstyle,
                 keywordstyle=\keywordFmt,
                 identifierstyle=\relax,
                 % stringstyle=\relax,
                 commentstyle=\commentFmt,
                 breaklines=true,
                 breakatwhitespace=true,   % doesn't do anything (?!)
                 mathescape=true,   % interprets $...$ in listing as math mode
                 % tabsize=8,
                 texcl=false}


% ---------------------------------------------------------------------------
% ----------------------- Standard math/CS notations ------------------------
% ---------------------------------------------------------------------------

\newcommand{\subtype}{\leq}

\newcommand{\union}{\mathrel{\cup}}
\newcommand{\sect}{\mathrel{\cap}}
\newcommand{\unit}{\texttt{()}}
\newcommand{\bang}{\texttt{!}}
\renewcommand{\gets}{\mathop{\texttt{:=}}}

\newcommand{\down}{\mathrel{\,\Downarrow\,}}
\newcommand{\step}{\mathrel{\,\Rightarrow\,}}

\newcommand{\syn}{\mathrel{\,\Rightarrow\,}}
\newcommand{\chk}{\mathrel{\,\Leftarrow\,}}
\newcommand{\arr}{\mathrel{\texttt{->}}}
\newcommand{\entails}{\vdash}
\newcommand{\such}{~|~}

\newcommand{\unif}{\doteq}
\newcommand{\totp}{\Rightarrow}
\newcommand{\emp}{\emptyset}

\newcommand{\sectty}{\mathrel{\text{\&}}}

\newcommand{\D}{{\mathcal{D}}}
\newcommand{\C}{{\mathcal{C}}}
\newcommand{\E}{{\mathcal{E}}}
\newcommand{\F}{{\mathcal{F}}}
\newcommand{\V}{{\mathcal{V}}}
\newcommand{\W}{{\mathcal{W}}}
\newcommand{\St}{{\mathcal{S}}}

\newcommand{\edot}{\bullet}

% \newcommand{\arrow}{\rightarrow}

% \newcommand{\chk}{\Leftarrow}
% \newcommand{\syn}{\Rightarrow}
% \newcommand{\bnfas}{\mathrel{::=}}
% \newcommand{\bnfalt}{\mathrel{\mid}}

%\newcommand{\shift}{\textsf{shift}\;}
\newcommand{\shift}{\uparrow\!}
% \newcommand{\lam}{\lambda}
% \newcommand{\lam}{\textsf{lam}\;}
% \newcommand{\app}{\textsf{app}\;}
\newcommand{\app}{}
% \newcommand{\lam}{\lambda}

\newcommand{\shiftby}{\textsf{shift}\;}


% ---------------------------------------------------------------------------
% ------------------------ Judgments, properties, types ---------------------
% ---------------------------------------------------------------------------

\newcommand{\Int}{\textsf{int}}
\newcommand{\Float}{\textsf{float}}
\newcommand{\Bool}{\textsf{bool}}
\newcommand{\Real}{\textsf{real}}
\newcommand{\String}{\textsf{string}}
\newcommand{\Char}{\textsf{char}}
\newcommand{\Nat}{\textsf{nat}}
\newcommand{\Unit}{\textsf{unit}}
\newcommand{\Ref}{~\textsf{ref}}
\newcommand{\Array}{~\textsf{array}}

\newcommand{\Value}{~\mathsf{value}}
\newcommand{\Halts}{~\mathsf{halts}}
\newcommand{\Steps}{\mathrel{\,\longrightarrow\,}}
\newcommand{\MSteps}{\longrightarrow^*}


\newcommand{\FV}{\mathsf{FV}}
\newcommand{\FMV}{\mathsf{FMV}}


% ---------------------------------------------------------------------------
% ------------------------ Terms for object languages -----------------------
% ---------------------------------------------------------------------------

\newcommand{\tmtrue}{\textsf{true}}
\newcommand{\tmfalse}{\textsf{false}}
\newcommand{\tmif}[3]{\textsf{if\;} #1 \textsf{\;then\;} #2 \textsf{\;else\;} #3}
\newcommand{\tmfun}[3]{\textsf{fun } #1 (#2) = #3}
\newcommand{\tmfn}[2]{\textsf{fn } #1\;\texttt{=>}\;#2}
\newcommand{\tmapp}[2]{#1\;#2}
\newcommand{\tmrectyp}[3]{\textsf{rec } {#1}\,:\,{#2}\;\texttt{=>}\;#3}
\newcommand{\tmrec}[2]{\textsf{rec } {#1}\texttt{=>}\;#2}
\newcommand{\tmlet}[3]{\textsf{let } #1 = #2 \textsf{\;in\;} #3\; \textsf{end}}

\newcommand{\tmfst}[1]{\textsf{fst}\;{#1}\xspace}
\newcommand{\tmsnd}[1]{\textsf{snd}\;{#1}\xspace}

% Numerical expressions
\newcommand{\tmzero}{\textsf{z}}
\newcommand{\tmsucc}[1]{\textsf{succ}~#1}
\newcommand{\tmpred}[1]{\textsf{pred}~#1}
\newcommand{\tmiszero}[1]{\textsf{iszero}~#1}

\newcommand{\bref}{\textsf{reflexive}}
\newcommand{\bmred}{\textsf{one{-}step}}
\newcommand{\btrans}{\textsf{transitive}}

\newcommand{\bred}{\beta{-}\textsf{red}}
\newcommand{\blam}{\textsf{lam{-}red}}
\newcommand{\appMred}{\textsf{app{-}red{-}1}}
\newcommand{\appNred}{\textsf{app{-}red{-}2}}

\newcommand{\type}{\textsf{type}}


% ---------------------------------------------------------------------------
% -------------------------- Inference rules' names -------------------------
% ---------------------------------------------------------------------------

\newcommand{\TIf}{\textsc{t-if}}
\newcommand{\TPred}{\textsc{t-pred}}
\newcommand{\TZero}{\textsc{t-zero}}
\newcommand{\TPlus}{\textsc{t-plus}}
\newcommand{\TMult}{\textsc{t-mult}}
\newcommand{\TEq}{\textsc{t-eq}}
\newcommand{\TApp}{\textsc{t-app}}
\newcommand{\TSub}{\textsc{t-sub}}
\newcommand{\TFn}{\textsc{t-fn}}
\newcommand{\TFun}{\textsc{t-fun}}
\newcommand{\TPair}{\textsc{t-pair}}
\newcommand{\TFst}{\textsc{t-fst}}
\newcommand{\TSnd}{\textsc{t-snd}}
\newcommand{\TVar}{\textsc{t-var}}
\newcommand{\TNum}{\textsc{t-num}}
\newcommand{\TTrue}{\textsc{t-true}}
\newcommand{\TFalse}{\textsc{t-false}}

\newcommand{\TBinaryPrimop}{\textsc{t-binary-primop}\xspace}
\newcommand{\TUnaryPrimop}{\textsc{t-unary-primop}\xspace}
\newcommand{\TTuple}{\textsc{t-tuple}\xspace}
\newcommand{\TTupleSyn}{\textsc{t-tuple-syn}\xspace}
\newcommand{\TRec}{\textsc{t-rec}\xspace}
\newcommand{\TAnno}{\textsc{t-anno}\xspace}

\newcommand{\TLet}{\textsc{t-let}\xspace}
\newcommand{\TLetSyn}{\textsc{t-let-syn}\xspace}
\newcommand{\TDecs}{\textsc{t-decs}\xspace}
\newcommand{\TByName}{\textsc{t-by-name}}
\newcommand{\TByVal}{\textsc{t-by-val}}
\newcommand{\TByValTuple}{\textsc{t-by-val-tuple}}

\newcommand{\EIfT}{\textsc{e-iftrue}\xspace}
\newcommand{\EIfF}{\textsc{e-iffalse}\xspace}
\newcommand{\EIf}{\textsc{e-if}\xspace}
\newcommand{\ESuc}{\textsc{e-succ}\xspace}
\newcommand{\EPred}{\textsc{e-pred}\xspace}
\newcommand{\EPredZ}{\textsc{e-pred-zero}\xspace}
\newcommand{\EPredSucc}{\textsc{e-pred-succ}\xspace}
\newcommand{\EIsZero}{\textsc{e-ifzero}\xspace}
\newcommand{\EIsZeroZ}{\textsc{e-ifzero-zero}\xspace}
\newcommand{\EIsZeroSucc}{\textsc{e-ifzero-succ}\xspace}
\newcommand{\EAppFnStep}{\textsc{e-app1}\xspace}
\newcommand{\EAppArgStep}{\textsc{e-app2}\xspace}
\newcommand{\EAppBeta}{\textsc{e-app-abs}\xspace}

\newcommand{\MRef}{\textsc{m-ref}}
\newcommand{\MTr}{\textsc{m-tr}}
\newcommand{\MStep}{\textsc{m-step}}

\newcommand{\VZero}{\textsc{v-zero}}
\newcommand{\VSuc}{\textsc{v-succ}}
\newcommand{\VTrue}{\textsc{v-true}}
\newcommand{\VFalse}{\textsc{v-false}}

\newcommand{\BAnno}{\textsc{b-anno}\xspace}
\newcommand{\BAnnoFn}{\textsc{b-anno-fn}\xspace}
\newcommand{\BAnnoNonFn}{\textsc{b-anno-non-fn}\xspace}
\newcommand{\BIFT}{\textsc{b-iftrue}\xspace}
\newcommand{\BIFF}{\textsc{b-iffalse}\xspace}
\newcommand{\BOp}{\textsc{b-op}\xspace}
\newcommand{\BPlus}{\textsc{b-plus}\xspace}
\newcommand{\BEq}{\textsc{b-eq}\xspace}
\newcommand{\BLet}{\textsc{b-let}\xspace}
\newcommand{\BNum}{\textsc{b-num}\xspace}
\newcommand{\BVar}{\textsc{b-var}\xspace}
\newcommand{\BIF}{\textsc{b-if}\xspace}
\newcommand{\BTrue}{\textsc{b-true}\xspace}
\newcommand{\BFalse}{\textsc{b-false}\xspace}
\newcommand{\BFun}{\textsc{b-fun}\xspace}
\newcommand{\BRec}{\textsc{b-rec}\xspace}

\newcommand{\BLetn}{\textsc{b-letn}\xspace}
\newcommand{\BLetp}{\textsc{b-letpair}\xspace}
\newcommand{\BPair}{\textsc{b-pair}\xspace}
\newcommand{\BFst}{\textsc{b-fst}\xspace}
\newcommand{\BSnd}{\textsc{b-snd}\xspace}
\newcommand{\BFn}{\textsc{b-fn}\xspace}
\newcommand{\BApp}{\textsc{b-app}\xspace}

\newcommand{\Rsectintro}{\textsc{$\sectty$intro}\xspace}
\newcommand{\Rsectelim}[1]{\textsc{$\sectty$elim{#1}}\xspace}


% ---------------------------------------------------------------------------
% ----------------------------------- ??? -----------------------------------
% ---------------------------------------------------------------------------

\newcommand{\hasty}[2]{#1~\mathsf{hastype}~#2}
\newcommand{\oftyp}{\mathtt{hastype}\;}
\newcommand{\jtype}{\mathit{type}}


\newcommand{\mdots}{\,.\hspace{-0.025cm}.\hspace{-0.025cm}.\,}


\newcommand{\eq}{\;\mathtt{eq}\;}

\newcommand{\lb}{{[\![}}
\newcommand{\rb}{{]\!]}}

\newcommand{\nl}{\overline{n}}

\renewcommand{\Tilde}{\textsf{\char"7E}}

\bibpunct{[}{]}{;}{a}{}{,}
\def\newblock{\hskip .11em plus .33em minus .07em}

\newcommand{\arrayenv}[1]{\renewcommand{\arraystretch}{1} \begin{array}[t]{@{}c@{}}#1\end{array}}
\newcommand{\arrayenvc}[1]{\renewcommand{\arraystretch}{1} \begin{array}[c]{@{}c@{}}#1\end{array}}
\newcommand{\arrayenvr}[1]{\renewcommand{\arraystretch}{1} \begin{array}[t]{@{}r@{}}#1\end{array}}
\newcommand{\arrayenvbr}[1]{\renewcommand{\arraystretch}{1} \begin{array}[b]{@{}r@{}}#1\end{array}}
\newcommand{\arrayenvl}[1]{\renewcommand{\arraystretch}{1} \begin{array}[t]{@{}l@{}}#1\end{array}}
\newcommand{\arrayenvb}[1]{\renewcommand{\arraystretch}{1}  \begin{array}[b]{@{}c@{}}#1\end{array}}
\newcommand{\arrayenvbl}[1]{\renewcommand{\arraystretch}{1}  \begin{array}[b]{@{}l@{}}#1\end{array}}

% ---------------------------------------------------------------------------
% ------------------- MAGIC (a.k.a. Work in Progress) -----------------------
% ---------------------------------------------------------------------------

\newcommand{\proofderiv}[2]{\mathbin{#1 \; :: \; #2 }}
\newcommand{\proofderivc}[3]{\proofderiv{#1}{#2 \vdash #3}}
\newenvironment{case}[1]{\paragraph{Case}{#1}\\[1em]}{}
\newenvironment{basecase}[1]{\paragraph{Base case}{#1}\\[1em]}{}
\newenvironment{stepcase}[1]{\paragraph{Step case}{#1}\\[1em]}{}
\newenvironment{subcase}[1]{\textbf{Subcase}{\quad #1}\\[0.5em]}{}


% ---------------------------------------------------------------------------
% --------------------------------- Other -----------------------------------
% ---------------------------------------------------------------------------

\newcommand{\emphFact}[1]{{\color{dGreen}{#1}}}
